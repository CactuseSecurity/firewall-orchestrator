
name: Build

on:

  push:
    paths-ignore:
    - 'documentation/**'
    - 'design/**'

  pull_request:
    types: [ ready_for_review, review_requested ]
    paths-ignore:
    - 'documentation/**'
    - 'design/**'
 
env:
    RUNNING_ON_GITHUB_ACTIONS: true
    
jobs:  
  test_install:    
    name: test build on ${{ matrix.os }}
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, ubuntu-20.04, ubuntu-22.04]
    steps:
    - name: set env
      run: |
        echo "Running on github actions? $RUNNING_ON_GITHUB_ACTIONS"
    - uses: actions/checkout@v4   
    - name: do test install in case of merged pull request
      run: cd /home/runner/work/firewall-orchestrator/firewall-orchestrator && ansible-playbook -e force_install=true site.yml -K
    - name: switch to fworch user for c# unit tests
      run: sudo su -l fworch && cd ~/test/csharp/FWO.Test && dotnet test