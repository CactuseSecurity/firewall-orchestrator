
name: Build

on:
  workflow_dispatch:

  push:
    paths-ignore:
    - 'documentation/**'
    - 'design/**'

  pull_request:
    types: [ ready_for_review, review_requested, sad ]
    paths-ignore:
    - 'documentation/**'
    - 'design/**'
    
jobs:        
  test_ubuntu_latest:
    name: test build on ubuntu latest
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3

    - name: Set environment variable
      run: echo "RUNNING_ON_GITHUB=1" >> $GITHUB_ENV

    - name: do test install in case of merged pull request
      run: cd /home/runner/work/firewall-orchestrator/firewall-orchestrator && ansible-playbook -e force_install=true site.yml -K
      env:
        RUNNING_ON_GITHUB_ACTIONS: ${{ env.RUNNING_ON_GITHUB }}

    - name: alter sandbox permission for chrome
      run: cd /usr/local/bin/Chrome/Linux-133.0.6943.53/chrome-linux64/ && sudo chown root:root chrome_sandbox && sudo chmod 4755 chrome_sandbox   

    - name: alter sandbox permission for chromeheadlessshell
      run: cd /usr/local/bin/ChromeHeadlessShell/Linux-133.0.6943.53/chrome-headless-shell-linux64/ && sudo chown root:root chrome_sandbox && sudo chmod 4755 chrome_sandbox   
      
    - name: Setup dotnet
      uses: actions/setup-dotnet@v4    
    - name: exec dotnet test
      run: cd /home/runner/work/firewall-orchestrator/firewall-orchestrator/roles/tests-unit/files/FWO.Test && dotnet restore && dotnet build && dotnet test --filter "Name=HtmlToPdfTest"
      env:
        RUNNING_ON_GITHUB_ACTIONS: ${{ env.RUNNING_ON_GITHUB }}
