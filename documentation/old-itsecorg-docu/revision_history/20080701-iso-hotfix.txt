-- $Id: 20080701-iso-hotfix.txt,v 1.1.2.2 2008-07-22 18:55:45 tim Exp $
-- $Source: /home/cvs/iso/package/install/migration/Attic/20080701-iso-hotfix.txt,v $
-- this is a collection from 20070821 to 20080531

# the following files must be updated:
# $ISOHOME/web/htdocs/inctxt/reporting_tables_druck.inc.php
#     fixed Filter for source and destination in "druckansicht"
# $ISOHOME/install/bin/agents/checkpoint-cp-config-locally.sh
#	switched compare function from cmp to diff, to fix audit log compare if it is appended
#   this caused an error using cmp
#	plus variuos improvements regarding user export and auditlog export
# $ISOHOME/install/database/iso-usr-import.sql
# $ISOHOME/importer/CACTUS/ISO/import.pm (nur Unterdrueckung der Ausage "last change time")
# $ISOHOME/importer/CACTUS/ISO/import/checkpoint.pm (import von csv-exportierten Userdaten)

# Install:
ISOHOME=/usr/local/itsecorg
cd $ISOHOME

# stop import:
/etc/init.d/itsecorg-importer stop

# backup original files:
tar cvfz /tmp/$ISOHOME/backup_itsecorg_pre_fix_20080725.tgz .

# extract files:
tar xvf /tmp/itsecorg_fix_20080725.tgz

# replace user import functions:
psql -U dbadmin -d isov1 -h localhost -c "\i $ISOHOME/install/database/iso-usr-import.sql"

# install check point itsecorg agent
#    $ISOHOME/install/bin/agents/checkpoint-cp-config-locally.sh
#    to smartcenter server and integrate into cron (run every minute)
#    double-check variables set in this script ($FWDIR/$CPDIR/...)

# check if files are created on smartcenter server:

user@smartcenter$ file /home/itsecorg
fwauth.NDB:                          ISO-8859 C program text, with very long lines
objects_5_0.C:                       ISO-8859 text
rulebases_5_0.fws:                   ASCII text

# not:
fwauth.NDB:                          data

# check current time stamp:
user@smartcenter$ ls -l /home/itsecorg
-rw-rw-rw- 1 itsecorg users  61440 2008-07-22 21:51 fwauth.NDB
-rw-rw-rw- 1 itsecorg users 595542 2008-07-22 21:51 objects_5_0.C
-rw-rw-rw- 1 itsecorg users 325345 2008-07-22 21:51 rulebases_5_0.fws

# run import:
cd $ISOHOME/importer
./iso-importer-single.pl mgm_name=<smartcenter management name>

# start import:
/etc/init.d/itsecorg-importer start
