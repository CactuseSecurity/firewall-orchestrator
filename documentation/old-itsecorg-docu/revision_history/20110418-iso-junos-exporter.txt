Installierte Module:

tim@acantha:~/Desktop$ sudo aptitude install libexpect-perl
Die folgenden NEUEN Pakete werden zusätzlich installiert:
  libexpect-perl libio-pty-perl{a} libio-stty-perl{a} 
0 Pakete aktualisiert, 3 zusätzlich installiert, 0 werden entfernt und 0 nicht aktualisiert.

Veränderte Dateien:

mod:
$ISODIR/web/
	htdocs/reporting_tables_config_cli.php
	include/
		display-table.php
		display_nwobject_config.php
		display_rule_config.php
		display_service_config.php
		(display_user_config.php) --> not implemented for junos export
		

mod: $ISODIR/importer/iso-importer-single.pl
new: $ISODIR/importer/iso-importer-reset-all.pl
mod: $ISODIR/importer/CACTUS/ISO/import/phion.pm --> Type des ersten Explizit-Objekts korrigiert (nur nw objekt!!!)

mod:
$ISODIR/install/database/iso-obj-import.sql: Datenbank-Funktion import_nwobj_single neu (weil Typ-Änderung nicht erkannt wurde)
$ISODIR/install/database/iso-obj-refs.sql: weiterer Bug gefunden in (Reihenfolge von objgroup_flat und objgroup Ref-Aenderungen hat nicht gepasst) 
	import_nwobj_refhandler_main(integer) ()
	import_nwobj_refhandler_insert (integer,varchar,INTEGER)
	import_nwobj_refhandler_change(INTEGER, INTEGER, INTEGER)
	new functions:
		import_nwobj_refhandler_insert_flat (integer,varchar,INTEGER)
		import_nwobj_refhandler_change_flat (INTEGER, INTEGER, INTEGER)
    Analog auch für nw-services und user

$ISODIR/install/database/iso-report.sql new functions:
		get_obj_ids_of_filtered_ruleset_flat
		get_rule_src_flat
		get_rule_dst_flat

$ISODIR/install/database/iso-rule-import.sql modified function: import_rules(integer,integer)
$ISODIR/install/database/iso-object-import.sql
$ISODIR/install/database/iso-object-service.sql
$ISODIR/install/database/iso-user-service.sql
	in import_[nwobj|svc|usr]_main rausgeworfen, da sonst fast keine objekte mehr importiert wurden
		(Objekte ausklammern, die vor dem vorherigen Import-Zeitpunkt geaendert wurden, Tuning-Masznahme)

--> am besten install/bin/db-init2-functions.sh ausführen

-- Neues Feld dev_id in einer Regel anlegen (kann NULL sein):
alter table rule add column dev_id integer;

CREATE OR REPLACE FUNCTION create_rule_dev_initial_entry_all () RETURNS VOID AS $$
DECLARE
    r_rule RECORD;
    r_dev RECORD;
BEGIN
	FOR r_dev IN SELECT * FROM device
	LOOP
		RAISE DEBUG 'fixing rules of device %', r_dev.dev_name || ' (id=' || r_dev.dev_id ||')';
		FOR r_rule IN SELECT rule_id,dev_id FROM rule_order WHERE dev_id=r_dev.dev_id GROUP BY rule_id,dev_id 
		LOOP UPDATE rule SET dev_id = r_rule.dev_id WHERE rule_id=r_rule.rule_id; END LOOP;
	END LOOP;
	RETURN;
END; 
$$ LANGUAGE plpgsql;

select * from create_rule_dev_initial_entry_all();

Create index "IX_Relationship186" on "rule" ("dev_id");
Alter table "rule" add  foreign key ("dev_id") references "device" ("dev_id") on update restrict on delete restrict;

cd $ISODIR/install/database
psql -d isov1 -U dbadmin -h localhost -c "\i iso-rule-import.sql"

cd $ISODIR/importer
./iso-importer-reset-all.pl

/*
alter table rule DROP CONSTRAINT rule_dev_id_fkey;
drop index "IX_Relationship186";
*/

==================

CREATE OR REPLACE FUNCTION create_rule_dev_initial_entry (INTEGER) RETURNS VOID AS $$
DECLARE
    i_dev_id  ALIAS FOR $1;
    r_rule RECORD; -- Datensatz mit einzelner rule_id aus import_rule-Tabelle
BEGIN

	RAISE DEBUG 'create_rule_dev_initial_entry - starting';
	FOR r_rule IN SELECT rule_id,dev_id FROM rule_order WHERE dev_id=i_dev_id group by rule_id,dev_id
	LOOP
		RAISE DEBUG 'updating rule %', r_rule.rule_id;
		UPDATE rule SET dev_id = r_rule.dev_id WHERE rule_id=r_rule.rule_id;
	END LOOP;
	RAISE DEBUG 'create_rule_dev_initial_entry - end of function, exiting normally';
	RETURN;
END; 
$$ LANGUAGE plpgsql;

===
Objekte in einer Gruppe werden nicht angelegt:
"4642936"%"fwpcredhsh11"%"group"%"fwpcredhsh11__10.23.65.108|fwpcredhsh11__8.23.65.108"%"964275188,19251,1280503142__10.23.65.108|964275188,19251,1280503142__8.23.65.108"%%%%%%%%"964275188,19251,1280503142"%%
"4642936"%"fwpcredhsh11__10.23.65.108"%"host"%%%%"10.23.65.108/32"%%%%%%"964275188,19251,1280503142__10.23.65.108"%%
"4642936"%"fwpcredhsh11__8.23.65.108"%"host"%%%%"8.23.65.108/32"%%%%%%"964275188,19251,1280503142__8.23.65.108"%%


vordefinierte Dienste nicht exportieren!

Bugfixes (php deprecated warnings wg. split, session_is_registered) beseitigt in:
$ISODIR/
	htdocs/
		hilfe.php
		reporting_tables.php
		submit_documentation_data.php
	include/
		check_privs.php
		db-base.php
		db-gui-config.php
================

Syntax junos:

policy:

security {
	policies {
		from-zone dcf-app-tier to-zone dcf-app-tier {
			inactive: policy 112 {
				match {
					source-address ADZ_2.51.42.0-24_Netz;
					destination-address [ FITS_2.51.41.50_SV FITS_2.51.41.51_SV FITS_2.51.41.52_SV FITS_2.51.41.58_SV FITS_2.51.41.59_SV FITS_2.51.41.60_SV ];
					application [ Kerberos_v5_TCP Kerberos_v5_UDP junos-ldap ldap-ssl junos-ping TCP_00139_nbsession TCP_01026 TCP_03268 TCP_1025 TCP_3269 TCP_445 TCP_5352 TCP_5362 TCP_5372 TCP_5382 UDP_00137_nbname UDP_00138_nbdatagram UDP_135 UDP_389 UDP_53 UDP_636 UDP_67 ADZ_UUID_FTASADC Http_Https RPC_135 ];
				}
				then {
					permit;
					log {
						session-init;
					}
				}
			}
		}
	}
}

Network objects (auch unterhalb von security):

security {
	zones {
        security-zone fwbb {
            address-book {
                address FITS_172.20.170.234_SV 172.20.170.234/32;
                address BLB_1.0.0.0-8_Net 1.0.0.0/8;                
                address-set FITS-Office-Netze {
                    address ADZ_2.172.160.0-24_Netz;
                    address FITS_2.172.161.0-24;
                    address IZO_2.248.251.0-24;
                }
            interfaces { --> kann ignoriert werden
                reth2.0;            	
			}
		}			
        security-zone global;  --> Zonen ohne Adressobjekte: ebenfalls ignorieren (höchstens zur Zonendefinition)		
	}
}


Services:

applications {
	application TCP_137 {
		protocol tcp;
		source-port 1024-65535;
		destination-port 137-137;
	}
    application SUN-RPC-WALLD {
        protocol tcp;
        rpc-program-number 100008-100008;
    }
    application echo-request_1 {
        protocol icmp;
        icmp-type 8;
        icmp-code 0;
    }
    application MS-AD-DRSUAPI {
        protocol tcp;
        uuid e3514235-4b06-11d1-ab04-00c04fc2dcd2;
    }
    application FTASIADC001_02 {
        term term0 protocol tcp uuid f6beaff7-1e19-4fbb-9f8f-b89e2018337c;
        term term1 protocol tcp uuid 30b044a5-a225-43f0-b3a4-e060df91f9c1;
        term term2 protocol tcp uuid 3c4728c5-f0ab-448b-bda1-6ce01eb0a6d6;
        term term3 protocol tcp uuid c9ac6db5-82b7-4e55-ae8a-e464ed7b4277;
        term term4 protocol tcp uuid 12345678-1234-abcd-ef00-0123456789ab;
        term term5 protocol tcp uuid 86d35949-83c9-4044-b424-db363231fd0c;
        term term6 protocol tcp uuid a398e520-d59a-4bdd-aa7a-3c1e0303a511;
        term term7 protocol tcp uuid 3473dd4d-2e88-4006-9cba-22570909dd10;
    }
    application icmp-proto {
        protocol 99;
        source-port 0-65535;
        destination-port 0-0;
    }
    application-set Http_Https {
        application junos-http;
        application junos-https;
    }            
}
