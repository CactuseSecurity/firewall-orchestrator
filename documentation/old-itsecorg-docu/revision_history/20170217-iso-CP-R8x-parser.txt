------ ITSecOrg platform changes -------------------------------

sudo apt-get install python-requests

# might need perl library for reading json files
sudo apt-get install libjson-perl

------ moved tmp dirs from /tmp to /var/tmp

sudo mkdir -p /var/tmp/itsecorg/tmp_import
sudo mkdir -p /var/tmp/itsecorg/archive_import
sudo chown -R itsecorg /var/tmp/itsecorg

change /usr/share/itsecorg/etc/import.conf:
	iso_workdir		/var/tmp/itsecorg/tmp_import				# Temporaeres Verzeichnis fuer Import-Daten des laufenden Imports
	archive_dir		/var/tmp/itsecorg/archive_import			# Verzeichnis fuer Archivierung von (Fehl-)importen


------ Database changes -------------------------------
insert into stm_track (track_id,track_name) VALUES (21,'network log');
insert into stm_action (action_id,action_name) VALUES (20,'inner layer'); -- check point r8x
insert into stm_obj_typ (obj_typ_id,obj_typ_name) VALUES (18,'simple-gateway');
insert into isoadmin (isoadmin_id,isoadmin_first_name,isoadmin_last_name,isoadmin_username) 
	VALUES (999,'Check Point R8x','System','System');

------- Check Point Management Server changes --------------------------

create user itsecorg with the following rights profile: Auditor (Read Only All)

Prepare API for itsecorg access:

	[Expert@stin-mgmt:0]# api  status
	
	API Settings:      
	---------------------
	Accessibility:                      Require ip 127.0.0.1     
	Automatic Start:                    Enabled                  

activate access to API:
	SmartConsole, navigating to Manage & Settings > Blades > Management API > Advanced Settings and changing the settings there. 
	api restart on command line of manager

	[Expert@sting:0]# api restart
	2016-May-26 18:29:53 - Stopping API...
	2016-May-26 18:29:56 - API stopped successfully.
	2016-May-26 18:29:56 - Starting API...
	. . . . . . . . . . . . . . . . . . . . . 
	2016-May-26 18:31:24 - API started successfully.
	[Expert@sting:0]#
	
	[Expert@stin-mgmt:0]# api status
	
	API Settings:      
	---------------------
	Accessibility:                      Require all granted      
	Automatic Start:                    Enabled                  

add CP CA cert to accepted certs in ubuntu ----------------------------------------- 
	- connect to https://<cp-mgmt>/api_docs/ with browser and safe certificate to file 
	- cp certificate to store:
	sudo cp cacert.pem /usr/share/ca-certificates
	And get it to rebuild the directory with your certificate included, run as root:
	sudo dpkg-reconfigure ca-certificates
	and select the ask option, scroll to your certificate, mark it for inclusion and select ok. 

======= Test environment specific issues: ======================
	sting:
		requests.exceptions.SSLError: hostname '192.168.100.110' doesn't match u'192.168.100.115'
	--> fix this
	
	https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk103840
		The migration process for an entire environment can be done in the following way:

    Renew the certificate for each involved Portal:

        If auto-generated certificates are used for Portals:
            In SmartDashboard, open the Security Gateway's object
            Go to the IPSec VPN pane
            In the "Repository of Certificates Available to the Gateway" section, select the certificate
            Click on the "Renew..." button - follow the instructions on the screen

        If certificates from 3rd party CA are used for Portals:
            Renew the certificate for each involved Portal according to the way the certificate was generated by the 3rd party CA
            In SmartDashboard, open the Security Gateway's object
            Go to the relevant Portal's pane
            Import the renewed 3rd party CA certificate

    Re-issue Security Gateway's certificates in the Security Gateway's object (go to the IPSec VPN pane)

    Reset the SIC with Security Gateway per sk65764

    No need to recreate the VPN Site on Remote Access Clients (because the Security Gateway's "DN" does not change)


------ Issues ----------------------------------------- 

- general stuff
	- make itsecorg-client accept the certificate installed at the CP manager
	- public key warning --> generate public key out of private key: ssh-keygen -y -f <private key file>
	- api get config takes rather long - big managements might run for more than 10 min? (bottleneck on sting-mgm with java running at 100%)
		- do we need to import application data? This is a huge block of data (# 'application-sites', 'application-site-categories', 'application-site-groups'
			--> currently left out)
		- might also reduce amount of data to get from manager by only retrieving the rules (if they contain all that is needed)
		- might have to set up a separate import process for R8x managements only to avoid blockage of other imports during R8x import
		- 2017-03-09 according to CP API owner Uri Bialik (ubialik@checkpoint.com) there will be performance enhancements in later versions of the API,
		  but it seems nothing significant will happen
	- plain text password in id_rsa file instead of key (without passphrase) --> not a real issue?
	
- rules:
	- Inner Layers need to be resolved

- Identity Awareness (User + Network in source of rule):
	DONE: networks uids can be mapped to existing objects (this always seems to be set and mapped --> use networks as source objects
	there can be multiple network objects --> use notation:
		IA_user@network1
		IA_user@network2
		IA_user@network3
	machines uids cannot be mapped to existing objects --> ignoring machines
	users uids cannot be mapped to existing objects --> ignoring users (or rather take access-role objects as user objects
	could we also have "networks": "any", ?

- nw objects:
	- ip_ranges --> how to handle these (currently = 0.0.0.0/0)

- Services:
	- DEBUG: es fehlen alle service-icmp Dienste: nicht in csv und nicht in config 
		diejenigen, die aus rule config geparst werden k√∂nnen, sind jetzt drin - allerdings fehlen alle icmp-Dienste, 
		die nur innerhalb von Gruppen und nicht explizit in Regeln auftauchen:
		NOTICE:  WARNUNG: ERR_GRP_MISS_SVC: Service Gruppenmitglied nicht vorhanden: icmp-requests (uid of group: 97aeb413-9aea-11d5-bd16-0090272ccb30), 97aeb40f-9aea-11d5-bd16-0090272ccb30
		NOTICE:  WARNUNG: ERR_GRP_MISS_SVC: Service Gruppenmitglied nicht vorhanden: ICMPgute (uid of group: 418c7c0a-956a-41ff-9bc1-5867b2265090), 97aeb40b-9aea-11d5-bd16-0090272ccb30
		NOTICE:  WARNUNG: ERR_GRP_MISS_SVC: Service Gruppenmitglied nicht vorhanden: IPv6_group (uid of group: d491a4c7-f70a-4842-b657-fdd192d820d7), f645e71b-27cd-43ac-8512-619867ac0c79
		NOTICE:  WARNUNG: ERR_GRP_MISS_SVC: Service Gruppenmitglied nicht vorhanden: IPv6_group (uid of group: d491a4c7-f70a-4842-b657-fdd192d820d7), 6f23dae7-0b9a-44f6-8515-b24690cd996c
