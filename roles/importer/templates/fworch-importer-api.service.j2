[Unit]
Description={{ product_name }} importer pure python

{% if 'apiserver' in group_names and 'middlewareserver' in group_names -%}
After=network.target remote-fs.target nss-lookup.target {{ api_service_name }}.service {{ middleware_service_name }}.service
{% elif 'apiserver' in group_names -%}
After=network.target remote-fs.target nss-lookup.target {{ api_service_name }}.service
{% elif 'middlewareserver' in group_names -%}
After=network.target remote-fs.target nss-lookup.target {{ middleware_service_name }}.service
{% else -%}
After=network.target remote-fs.target nss-lookup.target
{%- endif %}

[Service]
Type=simple
WorkingDirectory={{ importer_home }}
ExecStartPre=/bin/sleep 10
ExecStart={{ importer_venv_dir }}/bin/python {{ importer_home}}/import-main-loop.py
Environment="PATH={{ importer_venv_dir }}/bin"
Environment="VIRTUAL_ENV={{ importer_venv_dir }}"
TimeoutStopSec=300min
StandardOutput=journal
StandardError=journal
SyslogIdentifier={{ product_name }}-importer-api
User={{ fworch_user }}
KillSignal=SIGINT
Group={{ fworch_group }}
Restart=always

[Install]
WantedBy=multi-user.target
