@inject UserConfig userConfig
@using FWO.Report
@using FWO.Report.Data
@using FWO.Ui.Display

<TreeTable TItem="Rule" Nodes="RulesNodes">
    <CellTemplate Context="item">
        @item.Name
    </CellTemplate>
</TreeTable>

@code {
    [Parameter]
    public List<ManagementReport> Managements { get; set; } = new();

    List<TreeNode<Rule>> RulesNodes;

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();

        ManagementReportController management = Managements.Select(mgt => new ManagementReportController(mgt)).First();
        DeviceReportController device = management.Devices.Select(dev => DeviceReportController.FromDeviceReport(dev)).First();

        // Use TreeNodeBuilder to build tree structure from rules processed by CreateOrderNumberTree
        RulesNodes = TreeNodeBuilder.BuildRuleTreeFromManagementAndDevice(management, device);
    }
}
