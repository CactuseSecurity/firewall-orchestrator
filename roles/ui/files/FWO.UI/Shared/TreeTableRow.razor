@using FWO.Data.Report
@typeparam TItem

<tr>
    <td style="padding-left:@(Level * 1.5)rem">
        @if(Node.Children.Any())
        {
            <button class="btn btn-sm btn-link p-0" @onclick="() => OnToggle(Node)">
                @if(Node.IsExpanded)
                {
                    <Radzen.Blazor.RadzenIcon Icon="arrow_drop_down"></Radzen.Blazor.RadzenIcon>
                }
                else
                {
                    <Radzen.Blazor.RadzenIcon Icon="arrow_right"></Radzen.Blazor.RadzenIcon>
                }
            </button>
        }
        else
        {
            <span style="display:inline-block;width:1.2rem"></span>
        }
        @CellTemplate(Node.Item)
    </td>
</tr>

@if(Node.IsExpanded)
{
    @foreach(var child in Node.Children)
    {
        <TreeTableRow TItem="TItem"
                      Node="child"
                      Level="Level + 1"
                      CellTemplate="CellTemplate"
                      OnToggle="OnToggle" />
    }
}

@code {
    [Parameter] 
    public TreeNode<TItem> Node { get; set; }

    [Parameter] 
    public int Level { get; set; }

    [Parameter] 
    public RenderFragment<TItem> CellTemplate { get; set; }

    [Parameter] 
    public Action<TreeNode<TItem>> OnToggle { get; set; }
}
